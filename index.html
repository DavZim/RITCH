<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Allows To Efficiently Parse ITCH Files (Version 5.0) to an R data.table.">
<title>R Parser for the ITCH-Protocol • RITCH</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="R Parser for the ITCH-Protocol">
<meta property="og:description" content="Allows To Efficiently Parse ITCH Files (Version 5.0) to an R data.table.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">RITCH</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.14</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DavZim/RITCH/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ritch---an-r-interface-to-the-itch-protocol">RITCH - an R interface to the ITCH Protocol<a class="anchor" aria-label="anchor" href="#ritch---an-r-interface-to-the-itch-protocol"></a>
</h1></div>
<!-- badges: start -->

<p>The <code>RITCH</code> library provides an <code>R</code> interface to NASDAQs ITCH protocol, which is used to distribute financial messages to participants. Messages include orders, trades, market status, and much more financial information. A full list of messages is shown later. The main purpose of this package is to parse the binary ITCH files to a <a href="https://CRAN.R-project.org/package=data.table" class="external-link"><code>data.table</code></a> in <code>R</code>.</p>
<p>The package leverages <a href="https://CRAN.R-project.org/package=Rcpp" class="external-link"><code>Rcpp</code></a> and <code>C++</code> for efficient message parsing.</p>
<p>Note that the package provides a small simulated sample dataset in the <code>ITCH_50</code> format for testing and example purposes. Helper functions are provided to list and download sample files from NASDAQs official server.</p>
<div class="section level2">
<h2 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h2>
<p>To install <code>RITCH</code> you can use the following</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stable version:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"RITCH"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># development version:</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"DavZim/RITCH"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-overview">Quick Overview<a class="anchor" aria-label="anchor" href="#quick-overview"></a>
</h2>
<p>The main functions of <code>RITCH</code> are read-related and are easily identified by their <code>read_</code> prefix.</p>
<p>Due to the inherent structural differences between message classes, each class has its own read function. A list of message types and the respective classes are provided later in this Readme.</p>
<p>Example message classes used in this example are <em>orders</em> and <em>trades</em>. First we define the file to load and count the messages, then we read in the orders and the first 100 trades</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davzim.github.io/RITCH/">RITCH</a></span><span class="op">)</span></span>
<span><span class="co"># use built in example dataset</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># count the number of messages in the file</span></span>
<span><span class="va">msg_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/count_functions.html">count_messages</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [Counting]   12,012 total messages found</span></span>
<span><span class="co">#&gt; [Converting] to data.table</span></span>
<span><span class="co">#&gt; [Done]       in 0.01 secs at 87.25MB/s</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">msg_count</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 22  2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">msg_count</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "msg_type" "count"</span></span>
<span></span>
<span><span class="co"># read the orders into a data.table</span></span>
<span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_orders</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [Counting]   num messages 12,012</span></span>
<span><span class="co">#&gt; [Counting]   num 'orders' messages 5,000</span></span>
<span><span class="co">#&gt; [Converting] to data.table</span></span>
<span><span class="co">#&gt; [Done]       in 0.09 secs at 5.05MB/s</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">orders</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5000   13</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">orders</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "msg_type"        "stock_locate"    "tracking_number" "timestamp"       "order_ref"       "buy"            </span></span>
<span><span class="co">#&gt;  [7] "shares"          "stock"           "price"           "mpid"            "date"            "datetime"       </span></span>
<span><span class="co">#&gt; [13] "exchange"</span></span>
<span></span>
<span><span class="co"># read the first 100 trades</span></span>
<span><span class="va">trades</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_trades</a></span><span class="op">(</span><span class="va">file</span>, n_max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; [Note]       n_max overrides counting the messages. Number of messages may be off</span></span>
<span><span class="co">#&gt; [Filter]     skip: 0 n_max: 100 (1 - 100)</span></span>
<span><span class="co">#&gt; [Counting]   num 'trades' messages 300</span></span>
<span><span class="co">#&gt; [Converting] to data.table</span></span>
<span><span class="co">#&gt; [Done]       in 0.06 secs at 7.74MB/s</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">trades</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100  14</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trades</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "msg_type"        "stock_locate"    "tracking_number" "timestamp"       "order_ref"       "buy"            </span></span>
<span><span class="co">#&gt;  [7] "shares"          "stock"           "price"           "match_number"    "cross_type"      "date"           </span></span>
<span><span class="co">#&gt; [13] "datetime"        "exchange"</span></span></code></pre></div>
<p>Note that the file can be a plain <code>ITCH_50</code> file or a gzipped <code>ITCH_50.gz</code> file, which will be decompressed to the current directory. You may also note that the output reports quite a low read speed in the <code>MB/s</code>. This lowish number is due to including the parsing process, furthermore, due to overhead of setup code, this number gets higher on larger files.</p>
<p>If you want to know more about the functions of the package, read on.</p>
</div>
<div class="section level2">
<h2 id="main-functions">Main Functions<a class="anchor" aria-label="anchor" href="#main-functions"></a>
</h2>
<p><code>RITCH</code> provides the following main functions:</p>
<ul>
<li>
<code>read_itch(file, ...)</code> to read an ITCH file Convenient wrappers for different message classes such as <code>orders</code>, <code>trades</code>, etc are also provided as <code><a href="reference/read_functions.html">read_orders()</a></code>, <code><a href="reference/read_functions.html">read_trades()</a></code>, …</li>
<li>
<code>filter_itch(infile, outfile, ...)</code> to filter an ITCH file and write directly to another file without loading the data into R</li>
<li>
<code>write_itch(data, file, ...)</code> to write a dataset to an ITCH file</li>
</ul>
<p>There are also some helper functions provided, a selection is:</p>
<ul>
<li>
<code>download_sample_file(choice)</code> to download a sample file from the NASDAQ server and <code><a href="reference/list_sample_files.html">list_sample_files()</a></code> to get a list of all available sample files</li>
<li>
<code>download_stock_directory(exchange, date)</code> to download the stock locate information for a given exchange and date</li>
<li>
<code><a href="reference/open_itch_sample_server.html">open_itch_sample_server()</a></code> to open the official NASDAQ server in your browser, which hosts among other things example data files</li>
<li>
<code>gzip_file(infile, outfile)</code> and <code>gunzip_file(infile, outfile)</code> for gzip functionality</li>
<li>
<code><a href="reference/open_itch_specification.html">open_itch_specification()</a></code> to open the official NASDAQ ITCH specification PDF in your browser</li>
</ul>
</div>
<div class="section level2">
<h2 id="writing-itch-files">Writing ITCH Files<a class="anchor" aria-label="anchor" href="#writing-itch-files"></a>
</h2>
<p><code>RITCH</code> also provides functionality for writing ITCH files. Although it could be stored in other file formats (for example a database or a <a href="https://CRAN.R-project.org/package=qs" class="external-link"><code>qs</code></a> file), ITCH files are quite optimized regarding size as well as write/read speeds. Thus the <code><a href="reference/write_itch.html">write_itch()</a></code> function allows you to write a single or multiple types of message to an <code>ITCH_50</code> file. Note however, that only the standard columns are supported. Additional columns will not be written to file!</p>
<p>Additional information can be saved in the filename. By default the date, exchange, and fileformat information is added to the filename unless you specify <code>add_meta = FALSE</code>, in which case the given name is used.</p>
<p>As a last note: if you write your data to an ITCH file and want to filter for stocks later on, make sure to save the stock directory of that day/exchange, either externally or in the ITCH file directly (see example below).</p>
<div class="section level3">
<h3 id="simple-write-example">Simple Write Example<a class="anchor" aria-label="anchor" href="#simple-write-example"></a>
</h3>
<p>A simple write example would be to read all modifications from an ITCH file and save it to a separate file to save space, reduce read times later on, etc.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span>
<span><span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_modifications</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2000   13</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "msg_type"        "stock_locate"    "tracking_number" "timestamp"       "order_ref"       "shares"         </span></span>
<span><span class="co">#&gt;  [7] "match_number"    "printable"       "price"           "new_order_ref"   "date"            "datetime"       </span></span>
<span><span class="co">#&gt; [13] "exchange"</span></span>
<span></span>
<span><span class="va">outfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/write_itch.html">write_itch</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"modifications"</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [Counting]   2,000 messages (44,748 bytes) found</span></span>
<span><span class="co">#&gt; [Converting] to binary .</span></span>
<span><span class="co">#&gt; [Writing]    to file</span></span>
<span><span class="co">#&gt; [Outfile]    'modifications_20101224.TEST_ITCH_50.gz'</span></span>
<span><span class="co">#&gt; [Done]       in 0.01 secs at 1.94MB/s</span></span>
<span></span>
<span><span class="co"># compare file sizes</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>full_file <span class="op">=</span> <span class="va">file</span>, subset_file <span class="op">=</span> <span class="va">outfile</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/format_bytes.html">format_bytes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">file.size</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   full_file subset_file </span></span>
<span><span class="co">#&gt;  "465.05KB"   "23.95KB"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comprehensive-write-example">Comprehensive Write Example<a class="anchor" aria-label="anchor" href="#comprehensive-write-example"></a>
</h3>
<p>A typical work flow would look like this:</p>
<ul>
<li>read in some message classes from file and filter for certain stocks</li>
<li>save the results for later analysis, also compress to save disk space</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Read in the different message classes</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read in the different message types</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_itch</a></span><span class="op">(</span><span class="va">file</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"system_events"</span>, <span class="st">"stock_directory"</span>, <span class="st">"orders"</span><span class="op">)</span>,</span>
<span>                  filter_stock_locate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                  quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ stock_directory:Classes 'data.table' and 'data.frame':    2 obs. of  21 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;  $ orders         :Classes 'data.table' and 'data.frame':    2518 obs. of  13 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span>
<span></span>
<span></span>
<span><span class="co">## Write the different message classes</span></span>
<span><span class="va">outfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/write_itch.html">write_itch</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                      <span class="st">"alc_char_subset"</span>,</span>
<span>                      compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [Counting]   2,520 messages (95,766 bytes) found</span></span>
<span><span class="co">#&gt; [Converting] to binary .</span></span>
<span><span class="co">#&gt; [Writing]    to file</span></span>
<span><span class="co">#&gt; [Outfile]    'alc_char_subset_20101224.TEST_ITCH_50.gz'</span></span>
<span><span class="co">#&gt; [Done]       in 0.02 secs at 2.28MB/s</span></span>
<span><span class="va">outfile</span></span>
<span><span class="co">#&gt; [1] "alc_char_subset_20101224.TEST_ITCH_50.gz"</span></span>
<span></span>
<span><span class="co"># compare file sizes</span></span>
<span><span class="fu"><a href="reference/format_bytes.html">format_bytes</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>full_file <span class="op">=</span> <span class="va">file</span>, subset_file <span class="op">=</span> <span class="va">outfile</span><span class="op">)</span>,</span>
<span>         <span class="va">file.size</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   full_file subset_file </span></span>
<span><span class="co">#&gt;  "465.05KB"   "37.89KB"</span></span>
<span></span>
<span></span>
<span><span class="co">## Lastly, compare the two datasets to see if they are identical</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_itch</a></span><span class="op">(</span><span class="va">outfile</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">data2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>For comparison, the same format in the <a href="https://CRAN.R-project.org/package=qs" class="external-link"><code>qs</code></a> format results in <code>44788</code> bytes. <!---qs::qsave(data, "data.qs", preset = "archive");file.info("data.qs")[["size"]];unlink("data.qs")--></p>
</div>
</div>
<div class="section level2">
<h2 id="itch-messages">ITCH Messages<a class="anchor" aria-label="anchor" href="#itch-messages"></a>
</h2>
<p>There are a total of 22 different message types which are grouped into 13 classes by <code>RITCH</code>.</p>
<p>The messages and their respective classes are:</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="17%">
<col width="30%">
<col width="28%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">Type</th>
<th align="left">
<code>RITCH</code> Class</th>
<th align="left">
<code>RITCH</code> Read Function</th>
<th align="left">ITCH Name</th>
<th align="left">ITCH Spec Section</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>S</code></td>
<td align="left">system_events</td>
<td align="left"><code><a href="reference/read_functions.html">read_system_events()</a></code></td>
<td align="left">System Event Message</td>
<td align="left">4.1</td>
</tr>
<tr class="even">
<td align="left"><code>R</code></td>
<td align="left">stock_directory</td>
<td align="left"><code><a href="reference/read_functions.html">read_stock_directory()</a></code></td>
<td align="left">Stock Directory</td>
<td align="left">4.2.1</td>
</tr>
<tr class="odd">
<td align="left"><code>H</code></td>
<td align="left">trading_status</td>
<td align="left"><code><a href="reference/read_functions.html">read_trading_status()</a></code></td>
<td align="left">Stock Trading Action</td>
<td align="left">4.2.2</td>
</tr>
<tr class="even">
<td align="left"><code>Y</code></td>
<td align="left">reg_sho</td>
<td align="left"><code><a href="reference/read_functions.html">read_reg_sho()</a></code></td>
<td align="left">Reg SHO Restriction</td>
<td align="left">4.2.3</td>
</tr>
<tr class="odd">
<td align="left"><code>L</code></td>
<td align="left">market_participant_states</td>
<td align="left"><code><a href="reference/read_functions.html">read_market_participant_states()</a></code></td>
<td align="left">Market Participant Position</td>
<td align="left">4.2.4</td>
</tr>
<tr class="even">
<td align="left"><code>V</code></td>
<td align="left">mwcb</td>
<td align="left"><code><a href="reference/read_functions.html">read_mwcb()</a></code></td>
<td align="left">MWCB Decline Level Message</td>
<td align="left">4.2.5.1</td>
</tr>
<tr class="odd">
<td align="left"><code>W</code></td>
<td align="left">mwcb</td>
<td align="left"><code><a href="reference/read_functions.html">read_mwcb()</a></code></td>
<td align="left">MWCB Status Message</td>
<td align="left">4.2.5.2</td>
</tr>
<tr class="even">
<td align="left"><code>K</code></td>
<td align="left">ipo</td>
<td align="left"><code><a href="reference/read_functions.html">read_ipo()</a></code></td>
<td align="left">IPO Quoting Period Update</td>
<td align="left">4.2.6</td>
</tr>
<tr class="odd">
<td align="left"><code>J</code></td>
<td align="left">luld</td>
<td align="left"><code><a href="reference/read_functions.html">read_luld()</a></code></td>
<td align="left">LULD Auction Collar</td>
<td align="left">4.2.7</td>
</tr>
<tr class="even">
<td align="left"><code>h</code></td>
<td align="left">trading_status</td>
<td align="left"><code><a href="reference/read_functions.html">read_trading_status()</a></code></td>
<td align="left">Operational Halt</td>
<td align="left">4.2.8</td>
</tr>
<tr class="odd">
<td align="left"><code>A</code></td>
<td align="left">orders</td>
<td align="left"><code><a href="reference/read_functions.html">read_orders()</a></code></td>
<td align="left">Add Order Message</td>
<td align="left">4.3.1</td>
</tr>
<tr class="even">
<td align="left"><code>F</code></td>
<td align="left">orders</td>
<td align="left"><code><a href="reference/read_functions.html">read_orders()</a></code></td>
<td align="left">Add Order - MPID Attribution Message</td>
<td align="left">4.3.2</td>
</tr>
<tr class="odd">
<td align="left"><code>E</code></td>
<td align="left">modifications</td>
<td align="left"><code><a href="reference/read_functions.html">read_modifications()</a></code></td>
<td align="left">Order Executed Message</td>
<td align="left">4.4.1</td>
</tr>
<tr class="even">
<td align="left"><code>C</code></td>
<td align="left">modifications</td>
<td align="left"><code><a href="reference/read_functions.html">read_modifications()</a></code></td>
<td align="left">Order Executed Message With Price Message</td>
<td align="left">4.4.2</td>
</tr>
<tr class="odd">
<td align="left"><code>X</code></td>
<td align="left">modifications</td>
<td align="left"><code><a href="reference/read_functions.html">read_modifications()</a></code></td>
<td align="left">Order Cancel Message</td>
<td align="left">4.4.3</td>
</tr>
<tr class="even">
<td align="left"><code>D</code></td>
<td align="left">modifications</td>
<td align="left"><code><a href="reference/read_functions.html">read_modifications()</a></code></td>
<td align="left">Order Delete Message</td>
<td align="left">4.4.4</td>
</tr>
<tr class="odd">
<td align="left"><code>U</code></td>
<td align="left">modifications</td>
<td align="left"><code><a href="reference/read_functions.html">read_modifications()</a></code></td>
<td align="left">Order Replace Message</td>
<td align="left">4.4.5</td>
</tr>
<tr class="even">
<td align="left"><code>P</code></td>
<td align="left">trades</td>
<td align="left"><code><a href="reference/read_functions.html">read_trades()</a></code></td>
<td align="left">Trade Message (Non-Cross)</td>
<td align="left">4.5.1</td>
</tr>
<tr class="odd">
<td align="left"><code>Q</code></td>
<td align="left">trades</td>
<td align="left"><code><a href="reference/read_functions.html">read_trades()</a></code></td>
<td align="left">Cross Trade Message</td>
<td align="left">4.5.2</td>
</tr>
<tr class="even">
<td align="left"><code>B</code></td>
<td align="left">trades</td>
<td align="left"><code><a href="reference/read_functions.html">read_trades()</a></code></td>
<td align="left">Broken Trade Message</td>
<td align="left">4.5.3</td>
</tr>
<tr class="odd">
<td align="left"><code>I</code></td>
<td align="left">noii</td>
<td align="left"><code><a href="reference/read_functions.html">read_noii()</a></code></td>
<td align="left">NOII Message</td>
<td align="left">4.6</td>
</tr>
<tr class="even">
<td align="left"><code>N</code></td>
<td align="left">rpii</td>
<td align="left"><code><a href="reference/read_functions.html">read_rpii()</a></code></td>
<td align="left">Retail Interest Message</td>
<td align="left">4.7</td>
</tr>
</tbody>
</table>
<p>Note that if you are interested in the exact definition of the messages and its components, you should look into the <a href="https://www.nasdaqtrader.com/content/technicalsupport/specifications/dataproducts/NQTVITCHspecification.pdf" class="external-link">official ITCH specification</a>, which can also be opened by calling <code><a href="reference/open_itch_specification.html">open_itch_specification()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The <code>RITCH</code> package provides a small, artificial dataset in the ITCH format for example and test purposes. To learn more about the dataset check <code><a href="reference/ex20101224.TEST_ITCH_50.html">?ex20101224.TEST_ITCH_50</a></code>.</p>
<p>To access the dataset use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/count_functions.html">count_messages</a></span><span class="op">(</span><span class="va">file</span>, add_meta_data <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     msg_type count                 msg_class                                  msg_name  doc_nr</span></span>
<span><span class="co">#&gt;  1:        S     6             system_events                      System Event Message     4.1</span></span>
<span><span class="co">#&gt;  2:        R     3           stock_directory                           Stock Directory   4.2.1</span></span>
<span><span class="co">#&gt;  3:        H     3            trading_status                      Stock Trading Action   4.2.2</span></span>
<span><span class="co">#&gt;  4:        Y     0                   reg_sho                       Reg SHO Restriction   4.2.3</span></span>
<span><span class="co">#&gt;  5:        L     0 market_participant_states               Market Participant Position   4.2.4</span></span>
<span><span class="co">#&gt;  6:        V     0                      mwcb                MWCB Decline Level Message 4.2.5.1</span></span>
<span><span class="co">#&gt;  7:        W     0                      mwcb                       MWCB Status Message 4.2.5.2</span></span>
<span><span class="co">#&gt;  8:        K     0                       ipo                 IPO Quoting Period Update   4.2.6</span></span>
<span><span class="co">#&gt;  9:        J     0                      luld                       LULD Auction Collar   4.2.7</span></span>
<span><span class="co">#&gt; 10:        h     0            trading_status                          Operational Halt   4.2.8</span></span>
<span><span class="co">#&gt; 11:        A  4997                    orders                         Add Order Message   4.3.1</span></span>
<span><span class="co">#&gt; 12:        F     3                    orders      Add Order - MPID Attribution Message   4.3.2</span></span>
<span><span class="co">#&gt; 13:        E   198             modifications                    Order Executed Message   4.4.1</span></span>
<span><span class="co">#&gt; 14:        C     0             modifications Order Executed Message With Price Message   4.4.2</span></span>
<span><span class="co">#&gt; 15:        X    45             modifications                      Order Cancel Message   4.4.3</span></span>
<span><span class="co">#&gt; 16:        D  1745             modifications                      Order Delete Message   4.4.4</span></span>
<span><span class="co">#&gt; 17:        U    12             modifications                     Order Replace Message   4.4.5</span></span>
<span><span class="co">#&gt; 18:        P  5000                    trades                 Trade Message (Non-Cross)   4.5.1</span></span>
<span><span class="co">#&gt; 19:        Q     0                    trades                       Cross Trade Message   4.5.2</span></span>
<span><span class="co">#&gt; 20:        B     0                    trades                      Broken Trade Message   4.5.3</span></span>
<span><span class="co">#&gt; 21:        I     0                      noii                              NOII Message     4.6</span></span>
<span><span class="co">#&gt; 22:        N     0                      rpii                   Retail Interest Message     4.7</span></span>
<span><span class="co">#&gt;     msg_type count                 msg_class                                  msg_name  doc_nr</span></span></code></pre></div>
<p>Note that the example dataset does not contain messages from all classes but is limited to 6 system messages, 3 stock directory, 3 stock trading action, 5000 trade, 5000 order, and 2000 order modification messages. As seen by the 3 stock directory messages, the file contains data about 3 made up stocks (see also the plot later in the Readme).</p>
<p>MASDAQ provides sample ITCH files on their official server at <a href="https://emi.nasdaq.com/ITCH/Nasdaq%20ITCH/" class="external-link uri">https://emi.nasdaq.com/ITCH/Nasdaq%20ITCH/</a> (or in R use <code><a href="reference/open_itch_sample_server.html">open_itch_sample_server()</a></code>) which can be used to test code on larger datasets. Note that the sample files are up to 5GB compressed, which inflate to about 13GB. To interact with the sample files, use <code><a href="reference/list_sample_files.html">list_sample_files()</a></code> and <code>download_sample_files()</code>.</p>
</div>
<div class="section level2">
<h2 id="notes-on-memory-and-speed">Notes on Memory and Speed<a class="anchor" aria-label="anchor" href="#notes-on-memory-and-speed"></a>
</h2>
<p>There are some tweaks available to deal with memory and speed issues. For faster reading speeds, you can increase the buffer size of the <code>read_</code> functions to something around 1 GB or more (<code>buffer_size = 1e9</code>).</p>
<div class="section level3">
<h3 id="provide-message-counts">Provide Message Counts<a class="anchor" aria-label="anchor" href="#provide-message-counts"></a>
</h3>
<p>If you have to read from a single file multiple times, for example because you want to extract orders and trades, you can count the messages beforehand and provide it to each read’s <code>n_max</code> argument, reducing the need to pass the file for counting the number of messages.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># count messages once</span></span>
<span><span class="va">n_msgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/count_functions.html">count_messages</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use counted messages multiple times, saving file passes</span></span>
<span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_orders</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, n_max <span class="op">=</span> <span class="va">n_msgs</span><span class="op">)</span></span>
<span><span class="va">trades</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_trades</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, n_max <span class="op">=</span> <span class="va">n_msgs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="batch-read">Batch Read<a class="anchor" aria-label="anchor" href="#batch-read"></a>
</h3>
<p>If the dataset does not fit entirely into RAM, you can do a partial read specifying <code>skip</code> and <code>n_max</code>, similar to this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/count_functions.html">count_orders</a></span><span class="op">(</span><span class="fu"><a href="reference/count_functions.html">count_messages</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_messages</span></span>
<span><span class="co">#&gt; [1] 5000</span></span>
<span></span>
<span><span class="co"># read 1000 messages at a time</span></span>
<span><span class="va">n_batch</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">n_parsed</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">n_parsed</span> <span class="op">&lt;</span> <span class="va">n_messages</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Parsing Batch %04i - %04i"</span>, <span class="va">n_parsed</span>, <span class="va">n_parsed</span> <span class="op">+</span> <span class="va">n_batch</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># read in a batch</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_orders</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, skip <span class="op">=</span> <span class="va">n_parsed</span>, n_max <span class="op">=</span> <span class="va">n_batch</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">": with %04i orders\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># use the data</span></span>
<span>  <span class="co"># ...</span></span>
<span>  <span class="va">n_parsed</span> <span class="op">&lt;-</span> <span class="va">n_parsed</span> <span class="op">+</span> <span class="va">n_batch</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Parsing Batch 0000 - 1000: with 1000 orders</span></span>
<span><span class="co">#&gt; Parsing Batch 1000 - 2000: with 1000 orders</span></span>
<span><span class="co">#&gt; Parsing Batch 2000 - 3000: with 1000 orders</span></span>
<span><span class="co">#&gt; Parsing Batch 3000 - 4000: with 1000 orders</span></span>
<span><span class="co">#&gt; Parsing Batch 4000 - 5000: with 1000 orders</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filter-when-reading-data">Filter when Reading Data<a class="anchor" aria-label="anchor" href="#filter-when-reading-data"></a>
</h3>
<p>You can also filter a dataset directly while reading messages for <code>msg_type</code>, <code>stock_locate</code>, <code>timestamp</code> range, as well as <code>stock</code>. Note that filtering for a specific stock, is just a shorthand lookup for the stocks’ <code>stock_locate</code> code, therefore a <code>stock_directory</code> needs to be supplied (either by providing the output from <code><a href="reference/read_functions.html">read_stock_directory()</a></code> or <code>download_stock_locate()</code>) or the function will try to extract the stock directory from the file (might take some time depending on the size of the file).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in the stock directory as we filter for stock names later on</span></span>
<span><span class="va">sdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_stock_directory</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">od</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_orders</a></span><span class="op">(</span></span>
<span>  <span class="va">file</span>,</span>
<span>  filter_msg_type <span class="op">=</span> <span class="st">"A"</span>,          <span class="co"># take only 'No MPID add orders'</span></span>
<span>  min_timestamp <span class="op">=</span> <span class="fl">43200000000000</span>, <span class="co"># start at 12:00:00.000000</span></span>
<span>  max_timestamp <span class="op">=</span> <span class="fl">55800000000000</span>, <span class="co"># end at 15:30:00.000000</span></span>
<span>  filter_stock_locate <span class="op">=</span> <span class="fl">1</span>,        <span class="co"># take only stock with code 1</span></span>
<span>  filter_stock <span class="op">=</span> <span class="st">"CHAR"</span>,          <span class="co"># but also take stock CHAR</span></span>
<span>  stock_directory <span class="op">=</span> <span class="va">sdir</span>          <span class="co"># provide the stock_directory to match stock names to stock_locates</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [Filter]     msg_type: 'A'</span></span>
<span><span class="co">#&gt; [Filter]     timestamp: 43200000000000 - 55800000000000 </span></span>
<span><span class="co">#&gt; [Filter]     stock_locate: '1', '3'</span></span>
<span><span class="co">#&gt; NOTE: as filter arguments were given, the number of messages may be off</span></span>
<span><span class="co">#&gt; [Counting]   num messages 12,012</span></span>
<span><span class="co">#&gt; [Counting]   num 'orders' messages 5,000</span></span>
<span><span class="co">#&gt; [Converting] to data.table</span></span>
<span><span class="co">#&gt; [Done]       in 0.07 secs at 6.71MB/s</span></span>
<span></span>
<span><span class="co"># count the different message types</span></span>
<span><span class="va">od</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">msg_type</span><span class="op">]</span></span>
<span><span class="co">#&gt;    msg_type    n</span></span>
<span><span class="co">#&gt; 1:        A 1082</span></span>
<span><span class="co"># see if the timestamp is in the specified range</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">od</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 43235810473334 55792143963723</span></span>
<span><span class="co"># count the stock/stock-locate codes</span></span>
<span><span class="va">od</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">stock_locate</span>, <span class="va">stock</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    stock_locate stock   n</span></span>
<span><span class="co">#&gt; 1:            3  CHAR 574</span></span>
<span><span class="co">#&gt; 2:            1   ALC 508</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filter-data-to-file">Filter Data to File<a class="anchor" aria-label="anchor" href="#filter-data-to-file"></a>
</h3>
<p>On larger files, reading the data into memory might not be the best idea, especially if only a small subset is actually needed. In this case, the <code>filter_itch</code> function will come in handy.</p>
<p>The basic design is identical to the <code>read_itch</code> function but instead of reading the messages into memory, they are immediately written to a file.</p>
<p>Taking the filter data example from above, we can do the following</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the function returns the final name of the output file</span></span>
<span><span class="va">outfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/filter_itch.html">filter_itch</a></span><span class="op">(</span></span>
<span>  infile <span class="op">=</span> <span class="va">file</span>,</span>
<span>  outfile <span class="op">=</span> <span class="st">"filtered"</span>,</span>
<span>  filter_msg_type <span class="op">=</span> <span class="st">"A"</span>,          <span class="co"># take only 'No MPID add orders'</span></span>
<span>  min_timestamp <span class="op">=</span> <span class="fl">43200000000000</span>, <span class="co"># start at 12:00:00.000000</span></span>
<span>  max_timestamp <span class="op">=</span> <span class="fl">55800000000000</span>, <span class="co"># end at 15:30:00.000000</span></span>
<span>  filter_stock_locate <span class="op">=</span> <span class="fl">1</span>,        <span class="co"># take only stock with code 1</span></span>
<span>  filter_stock <span class="op">=</span> <span class="st">"CHAR"</span>,          <span class="co"># but also take stock CHAR</span></span>
<span>  stock_directory <span class="op">=</span> <span class="va">sdir</span>          <span class="co"># provide the stock_directory to match stock names to stock_locates</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [Filter]     msg_type: 'A'</span></span>
<span><span class="co">#&gt; [Filter]     timestamp: 43200000000000 - 55800000000000 </span></span>
<span><span class="co">#&gt; [Filter]     stock_locate: '1', '3'</span></span>
<span><span class="co">#&gt; [Bytes]      scanned 465048, filtered 41116</span></span>
<span><span class="co">#&gt; [Messages]   scanned 10979, filtered 1082</span></span>
<span><span class="co">#&gt; [Done]       in 0.06 secs at 7.34MB/s</span></span>
<span></span>
<span><span class="fu"><a href="reference/format_bytes.html">format_bytes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">outfile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "41.12KB"</span></span>
<span></span>
<span><span class="co"># read in the orders from the filtered file</span></span>
<span><span class="va">od2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_orders</a></span><span class="op">(</span><span class="va">outfile</span><span class="op">)</span></span>
<span><span class="co">#&gt; [Counting]   num messages 1,082</span></span>
<span><span class="co">#&gt; [Counting]   num 'orders' messages 1,082</span></span>
<span><span class="co">#&gt; [Converting] to data.table</span></span>
<span><span class="co">#&gt; [Done]       in 0.07 secs at 592.53KB/s</span></span>
<span></span>
<span><span class="co"># check that the filtered dataset contains the same information as in the example above</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">od</span>, <span class="va">od2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="create-a-plot-with-trades-and-orders-of-the-largest-etfs">Create a Plot with Trades and Orders of the largest ETFs<a class="anchor" aria-label="anchor" href="#create-a-plot-with-trades-and-orders-of-the-largest-etfs"></a>
</h2>
<p>As a last step, a quick visualization of the example dataset</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Paket 'ggplot2' wurde unter R Version 4.2.2 erstellt</span></span>
<span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the data</span></span>
<span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_orders</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">trades</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_functions.html">read_trades</a></span><span class="op">(</span><span class="va">file</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># replace the buy-factor with something more useful</span></span>
<span><span class="va">orders</span><span class="op">[</span>, <span class="va">buy</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">buy</span>, <span class="st">"Bid"</span>, <span class="st">"Ask"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">orders</span>,</span>
<span>             <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">price</span>, color <span class="op">=</span> <span class="va">buy</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_step</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trades</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">stock</span><span class="op">~</span><span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Orders and Trades of Three Simulated Stocks"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Date: 2010-12-24 | Exchange: TEST"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source: RITCH package"</span>, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Price"</span>, color <span class="op">=</span> <span class="st">"Side"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">dollar</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; ℹ Please use `linewidth` instead.</span></span></code></pre></div>
<p><img src="reference/figures/README-ETF_plot-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="other-notes">Other Notes<a class="anchor" aria-label="anchor" href="#other-notes"></a>
</h2>
<p>If you find this package useful or have any other kind of feedback, I’d be happy if you let me know. Otherwise, if you need more functionality, please feel free to create an issue or a pull request.</p>
<p>Citation and CRAN release are WIP.</p>
<p>If you are interested in gaining a better understanding of the internal data structures, converting data to and from binary, have a look at the <code>debug</code> folder and its contents (only available on the <a href="https://github.com/DavZim/RITCH/" class="external-link">RITCH’s Github page</a>).</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/DavZim/RITCH/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/DavZim/RITCH/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing RITCH</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>David Zimmermann-Kollenda <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=RITCH" class="external-link"><img src="https://www.r-pkg.org/badges/version/RITCH" alt="CRAN status"></a></li>
<li><a href="https://www.r-pkg.org/pkg/RITCH" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/RITCH" alt="CRAN RStudio mirror downloads"></a></li>
<li><a href="https://github.com/DavZim/RITCH/actions" class="external-link"><img src="https://github.com/DavZim/RITCH/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Zimmermann-Kollenda.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
