<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function allows to perform very fast filter operations on large ITCH
files. The messages are written to another ITCH file."><title>Filters an ITCH file to another ITCH file — filter_itch • RITCH</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filters an ITCH file to another ITCH file — filter_itch"><meta property="og:description" content="This function allows to perform very fast filter operations on large ITCH
files. The messages are written to another ITCH file."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RITCH</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.14</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DavZim/RITCH/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Filters an ITCH file to another ITCH file</h1>
      <small class="dont-index">Source: <a href="https://github.com/DavZim/RITCH/blob/HEAD/R/filter_itch.R" class="external-link"><code>R/filter_itch.R</code></a></small>
      <div class="d-none name"><code>filter_itch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows to perform very fast filter operations on large ITCH
files. The messages are written to another ITCH file.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_itch</span><span class="op">(</span></span>
<span>  <span class="va">infile</span>,</span>
<span>  <span class="va">outfile</span>,</span>
<span>  filter_msg_class <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  filter_msg_type <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  filter_stock_locate <span class="op">=</span> <span class="cn">NA_integer_</span>,</span>
<span>  min_timestamp <span class="op">=</span> <span class="fu">bit64</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bit64/man/as.integer64.character.html" class="external-link">as.integer64</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  max_timestamp <span class="op">=</span> <span class="fu">bit64</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bit64/man/as.integer64.character.html" class="external-link">as.integer64</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  filter_stock <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  stock_directory <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  skip <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  n_max <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  gz <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force_gunzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force_cleanup <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>infile</dt>
<dd><p>the input file where the messages are taken from, can be a
gz-archive or a plain ITCH file.</p></dd>


<dt>outfile</dt>
<dd><p>the output file where the filtered messages are written to.
Note that the date and exchange information from the <code>infile</code> are used,
see also <code><a href="add_meta_to_filename.html">add_meta_to_filename()</a></code> for further information.</p></dd>


<dt>filter_msg_class</dt>
<dd><p>a vector of classes to load, can be "orders", "trades",
"modifications", ... see also <code><a href="get_msg_classes.html">get_msg_classes()</a></code>.
Default value is to take all message classes.</p></dd>


<dt>filter_msg_type</dt>
<dd><p>a character vector, specifying a filter for message types.
Note that this can be used to only return 'A' orders for instance.</p></dd>


<dt>filter_stock_locate</dt>
<dd><p>an integer vector, specifying a filter for locate codes.
The locate codes can be looked up by calling <code><a href="read_functions.html">read_stock_directory()</a></code>
or by downloading from NASDAQ by using <code><a href="download_stock_directory.html">download_stock_directory()</a></code>.
Note that some message types (e.g., system events, MWCB, and IPO) do not use
a locate code.</p></dd>


<dt>min_timestamp</dt>
<dd><p>an 64 bit integer vector (see also <code><a href="https://rdrr.io/pkg/bit64/man/as.integer64.character.html" class="external-link">bit64::as.integer64()</a></code>)
of minimum timestamp (inclusive).
Note: min and max timestamp must be supplied with the same length or left empty.</p></dd>


<dt>max_timestamp</dt>
<dd><p>an 64 bit integer vector (see also <code><a href="https://rdrr.io/pkg/bit64/man/as.integer64.character.html" class="external-link">bit64::as.integer64()</a></code>)
of maxium timestamp (inclusive).
Note: min and max timestamp must be supplied with the same length or left empty.</p></dd>


<dt>filter_stock</dt>
<dd><p>a character vector, specifying a filter for stocks.
Note that this a shorthand for the <code>filter_stock_locate</code> argument, as it
tries to find the stock_locate based on the <code>stock_directory</code> argument,
if this is not found, it will try to extract the stock directory from the file,
else an error is thrown.</p></dd>


<dt>stock_directory</dt>
<dd><p>A data.frame containing the stock-locate code relationship.
As outputted by <code><a href="read_functions.html">read_stock_directory()</a></code>.
Only used if <code>filter_stock</code> is set. To download the stock directory from
NASDAQs server, use <code><a href="download_stock_directory.html">download_stock_directory()</a></code>.</p></dd>


<dt>skip</dt>
<dd><p>Number of messages to skip before starting parsing messages,
note the skip parameter applies to the specific message class, i.e., it would
skip the messages for each type (e.g., skip the first 10 messages for each class).</p></dd>


<dt>n_max</dt>
<dd><p>Maximum number of messages to parse, default is to read all values.
Can also be a data.frame of msg_types and counts, as returned by
<code><a href="count_functions.html">count_messages()</a></code>.
Note the n_max parameter applies to the specific message class not the whole
file.</p></dd>


<dt>append</dt>
<dd><p>if the messages should be appended to the outfile, default is
false. Note, this is helpful if <code>skip</code> and or <code>n_max</code> are used for
batch filtering.</p></dd>


<dt>overwrite</dt>
<dd><p>if an existing outfile with the same name should be
overwritten. Default value is false</p></dd>


<dt>gz</dt>
<dd><p>if the output file should be gzip-compressed. Note that the name
of the output file will be appended with .gz if not already present. The
final output name is returned. Default value is false.</p></dd>


<dt>buffer_size</dt>
<dd><p>the size of the buffer in bytes, defaults to 1e8 (100 MB),
if you have a large amount of RAM, 1e9 (1GB) might be faster</p></dd>


<dt>quiet</dt>
<dd><p>if TRUE, the status messages are suppressed, defaults to FALSE</p></dd>


<dt>force_gunzip</dt>
<dd><p>only applies if the input file is a gz-archive and a file with the same (gunzipped) name already exists.
if set to TRUE, the existing file is overwritten. Default value is FALSE</p></dd>


<dt>force_cleanup</dt>
<dd><p>only applies if the input file is a gz-archive If force_cleanup=TRUE, the gunzipped raw file will be deleted afterwards.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>the name of the output file (maybe different from the inputted
outfile due to adding the date and exchange), silently</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that this can be especially useful on larger files or where memory
is not large enough to filter the datalimits the analysis.</p>
<p>As with the <code><a href="read_functions.html">read_itch()</a></code> functions, it allows to filter for
<code>msg_class</code>, <code>msg_type</code>, <code>stock_locate</code>/<code>stock</code>, and
<code>timestamp</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">infile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ex20101224.TEST_ITCH_50"</span>, package <span class="op">=</span> <span class="st">"RITCH"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">outfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">"_20101224.TEST_ITCH_50"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">filter_itch</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">infile</span>, <span class="va">outfile</span>,</span></span>
<span class="r-in"><span>  filter_msg_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orders"</span>, <span class="st">"trades"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filter_msg_type <span class="op">=</span> <span class="st">"R"</span>, <span class="co"># stock_directory</span></span></span>
<span class="r-in"><span>  skip <span class="op">=</span> <span class="fl">0</span>, n_max <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Filter]     skip: 0 n_max: 100 (1 - 100)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Filter]     msg_type: 'R', 'A', 'F', 'P', 'Q', 'B'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Bytes]      scanned 465048, filtered 8527</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Messages]   scanned 12012, filtered 203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Done]       in 0.14 secs at 3.40MB/s</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># expecting 100 orders, 100 trades, and 3 stock_directory entries</span></span></span>
<span class="r-in"><span><span class="fu"><a href="count_functions.html">count_messages</a></span><span class="op">(</span><span class="va">outfile</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   203 total messages found</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Converting] to data.table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Done]       in 0.00 secs at 41.11MB/s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msg_type count</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:        S     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:        R     3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:        H     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:        Y     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:        L     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:        V     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:        W     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:        K     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:        J     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:        h     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:        A    99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:        F     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:        E     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:        C     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:        X     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:        D     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:        U     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:        P   100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:        Q     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:        B     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:        I     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:        N     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msg_type count</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check that the output file contains the same</span></span></span>
<span class="r-in"><span><span class="va">res</span>  <span class="op">&lt;-</span> <span class="fu"><a href="read_functions.html">read_itch</a></span><span class="op">(</span><span class="va">outfile</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orders"</span>, <span class="st">"trades"</span>, <span class="st">"stock_directory"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num messages 203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num 'stock_directory' messages 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num 'orders' messages 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num 'trades' messages 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Converting] to data.table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Done]       in 0.14 secs at 62.87KB/s</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">nrow</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          orders          trades stock_directory </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             100             100               3 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_functions.html">read_itch</a></span><span class="op">(</span><span class="va">infile</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orders"</span>, <span class="st">"trades"</span>, <span class="st">"stock_directory"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  n_max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Note]       n_max overrides counting the messages. Number of messages may be off</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Filter]     skip: 0 n_max: 100 (1 - 100)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num 'stock_directory' messages 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num 'orders' messages 200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Counting]   num 'trades' messages 300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Converting] to data.table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Done]       in 0.14 secs at 3.34MB/s</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">res2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David Zimmermann-Kollenda.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

